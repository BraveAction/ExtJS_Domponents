var selModel;var store;var cxForm;var win;var falg = false;Ext.onReady(init);// 初始化方法function init() {	selModel = Ext.create('Ext.selection.CheckboxModel');	store = new Ext.data.Store({				autoLoad : false,				remoteSort : true,// 远程排序，默认false，为本地排序				proxy : new Ext.data.HttpProxy({							url : "servlet/Servlet?action=queryForList"						}),				fields : [{							name : 'deptno'						}, {							name : 'dname'						}, {							name : 'loc'						}]			});	cxForm = new Ext.widget({				xtype : 'form',				id : 'cxForm',				bodyPadding : 5,				width : 600,				fieldDefaults : {					labelAlign : 'left',					msgTarget : 'side'				},				defaults : {					anchor : '100%'				},				items : [{							xtype : 'container',							layout : 'hbox',							items : [{										xtype : 'container',										flex : 1,										border : false,										layout : 'anchor',										defaultType : 'textfield',										items : [{													fieldLabel : '部门编号',													name : 'deptno'												}, {													fieldLabel : '部门地址',													name : 'loc'												}]									}, {										xtype : 'container',										flex : 1,										layout : 'anchor',										defaultType : 'textfield',										items : [{													fieldLabel : '部门名称',													name : 'dname'												}]									}]						}],				buttons : [{							id : 'saveBtn',							text : '保存',							iconCls : 'save',							handler : save						}, {							id : 'cxBtn',							text : '查询',							iconCls : 'cxBtn',							handler : cxform						}, {							text : '重置',							handler : function() {								this.up('form').getForm().reset();							}						}]			})	win = Ext.create('widget.window', {				title : '查询面板',				closable : true,				closeAction : 'hide',				width : 600,				height : 150,				items : [cxForm]			});	var grid4 = Ext.create('Ext.grid.Panel', {				id : 'button-grid',				store : store,				columns : [{							text : "部门编号",							dataIndex : 'deptno'						}, {							text : "部门名称",							dataIndex : 'dname'						}, {							text : "部门地址",							dataIndex : 'loc'						}],				columnLines : true,				selModel : selModel,				// inline buttons				dockedItems : [{							xtype : 'pagingtoolbar',							load : function() {								var updateBtn = Ext.getCmp('update');								updateBtn.disable(true);								store.load();							},							dock : 'bottom',							width : 360,							displayInfo : true,							store : store						}, {							xtype : 'toolbar',							items : [{										text : '查询',										iconCls : 'cx',										id : 'cx',										handler : cx									}, {										text : '增加',										iconCls : 'add',										id : 'add',										handler : add									}, '-', {										text : '删除',										iconCls : 'del',										handler : del									}, '-', {										itemId : 'update',										text : '修改',										id : 'update',										handler : update									}]						}],				width : 600,				height : 300,				frame : true,				title : '部门表简单crud',				iconCls : 'icon-grid',				renderTo : Ext.getBody()			});}function del() {	var select = selModel.getSelection();	if (select.length > 1) {		alert("不支持批量删除");	} else if (select.length < 1) {		alert("请先选择");	} else {		Ext.Ajax.request({					url : 'servlet/Servlet?action=del',					params : {						deptno : select[0].data["deptno"]					},					success : function(response) {						alert('删除成功');					}				});	}	store.reload();}function cx() {	var button = Ext.get('cx');	var cxBtn = Ext.getCmp("cxBtn");	var saveBtn = Ext.getCmp("saveBtn");	saveBtn.disable(true);	cxBtn.enable(true);	win.setTitle("查询面板");	cxForm.getForm().reset();	cxForm.getForm().findField("deptno").enable(true);	cxForm.getForm().findField("dname").disable(true);	cxForm.getForm().findField("loc").disable(true);	button.dom.disabled = true;	if (win.isVisible()) {		win.hide(this, function() {					button.dom.disabled = false;				});	} else {		win.show(this, function() {					button.dom.disabled = false;				});	}}function cxform() {	var param = cxForm.getForm().getValues();	if (!param) {		return	} else {		Ext.Ajax.request({					url : 'servlet/Servlet?action=query',					params : {						deptno : param["deptno"]					},					success : function(response) {						// store.loadData(response.responseText);						var result = response.responseText;						win.hide();						store.loadData([Ext.JSON.decode(result)]);					}				});	}}function add() {	var button = Ext.get('add');	var cxBtn = Ext.getCmp("cxBtn");	var saveBtn = Ext.getCmp("saveBtn");	cxBtn.disable(true);	saveBtn.enable(true);	win.setTitle("添加面板");	cxForm.getForm().reset();	cxForm.getForm().findField("deptno").enable(true);	cxForm.getForm().findField("dname").enable(true);	cxForm.getForm().findField("loc").enable(true);	button.dom.disabled = true;	if (win.isVisible()) {		win.hide(this, function() {					button.dom.disabled = false;				});	} else {		win.show(this, function() {					button.dom.disabled = false;				});	}}function save() {	cxForm.getForm().findField("deptno").enable(true);// 修改时将deptno可见，否则保存时为空	var obj = cxForm.getForm().getValues();// 获取form中的值为对象	Ext.Ajax.request({				url : 'servlet/Servlet?action='						+ (falg == true ? "update" : "save"),// 开关机制action=save/update				params : {					deptno : obj["deptno"],					dname : obj["dname"],					loc : obj["loc"]				},				success : function(response) {					win.hide();					store.load();					falg = false;// 重置开关				}			});}function update() {	falg = true;// action=update	var button = Ext.get('add');	win.setTitle("修改面板");	Ext.getCmp("cxBtn").disable(true);// 查询按键不可用	Ext.getCmp("saveBtn").enable(true);// 启用保存按键	cxForm.getForm().findField("deptno").disable(true);	cxForm.getForm().findField("dname").enable(true);	cxForm.getForm().findField("loc").enable(true);	var record = selModel.getSelection();// 列表中所选择的数据	if (record.length < 1) {		alert('请先选择');		return;	} else if (record.length > 1) {		alert('不支持批量修改');		return;	} else {		win.show();		cxForm.getForm().setValues(record[0].data);// 将列表中所选择的数据放入form中	}}